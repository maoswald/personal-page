{{ define "main" }}
  {{ $hero := site.Params.hero }}
  {{ $langIndex := .Site.Language.Params.heroTaglineIndex | default 0 }}
  {{ $tagline := index $hero.taglines $langIndex | default $hero.taglineDefault }}
  {{ $lang := .Language.Lang }}
  {{ $defaultLang := site.Params.defaultLanguage | default $lang }}
  {{ $taglineParts := split $tagline "—" }}
  {{ $leftTagline := trim (index $taglineParts 0 | default $tagline) " " }}
  {{ $rightTagline := "" }}
  {{ if ge (len $taglineParts) 2 }}
    {{ $rightTagline = trim (index $taglineParts 1) " " }}
  {{ end }}
  <section class="hero-split" aria-labelledby="identity-heading">
    <div class="hero-visual">
      <div class="hero-visual-pane hero-visual-pane-left" aria-hidden="true"></div>
      <div class="hero-visual-pane hero-visual-pane-right" aria-hidden="true"></div>
      <h1 class="hero-visual-tagline" id="identity-heading" aria-label="{{ $tagline }}">
        <span class="hero-visual-text hero-visual-text-left">{{ $leftTagline }}</span>
        <span class="hero-visual-dash" aria-hidden="true">—</span>
        <span class="hero-visual-text hero-visual-text-right">{{ if ne $rightTagline "" }}{{ $rightTagline }}{{ else }}{{ $leftTagline }}{{ end }}</span>
      </h1>
    </div>
    <div class="hero-content">
      <div class="hero-columns">
        <div class="hero-column hero-column-tech">
          <div class="hero-heading hero-heading-tech">
            <h2>{{ i18n "heroTechTitle" }}</h2>
            <a class="button button-primary" href="{{ "/about/" | relLangURL }}">{{ i18n "heroTechCta" }}</a>
          </div>
        </div>
        <div class="hero-column hero-column-sailing">
          <div class="hero-heading hero-heading-sailing">
            <a class="button button-ghost" href="{{ "/travel/" | relLangURL }}">{{ i18n "heroSailCta" }}</a>
            <h2>{{ i18n "heroSailTitle" }}</h2>
          </div>
        </div>
      </div>
    </div>
  </section>

  {{ $allPosts := where .Site.RegularPages "Type" "post" }}
  {{ $latestLocalized := where $allPosts "Lang" $lang }}
  {{ if and (ne $lang $defaultLang) (lt (len $latestLocalized) 1) }}
    {{ $latestLocalized = where $allPosts "Lang" $defaultLang }}
  {{ end }}
  {{ $latestPosts := first 1 $latestLocalized }}
  <section class="section" aria-labelledby="recent-posts">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title" id="recent-posts">{{ i18n "recentPosts" }}</h2>
        <a href="{{ "/blog/" | relLangURL }}">Blog</a>
      </div>
      <div class="card-grid">
        {{ range $latestPosts }}
          <article class="card">
            {{ with .Params.cover }}<img src="{{ . | relURL }}" alt="" loading="lazy" />{{ end }}
            <h3><a href="{{ .RelPermalink }}" data-prefetch>{{ .Title }}</a></h3>
            <p>{{ .Summary }}</p>
            <p class="timeline-meta">{{ .Date.Format "02 Jan 2006" }} · {{ .ReadingTime }} min</p>
            <div class="tech-badges">
              {{ range .Params.tags }}<span class="tag-chip">{{ . }}</span>{{ end }}
            </div>
          </article>
        {{ end }}
      </div>
    </div>
  </section>

  {{ $allProjects := where .Site.RegularPages "Type" "project" }}
  {{ $projectsLocalized := where $allProjects "Lang" $lang }}
  {{ if and (ne $lang $defaultLang) (lt (len $projectsLocalized) 1) }}
    {{ $projectsLocalized = where $allProjects "Lang" $defaultLang }}
  {{ end }}
  {{ $featured := first 1 $projectsLocalized }}
  {{ with index $featured 0 }}
    <section class="section" aria-labelledby="featured-project">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title" id="featured-project">{{ i18n "featuredProject" }}</h2>
          <a href="{{ "/projects/" | relLangURL }}">Projects</a>
        </div>
        <article class="card">
          <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
          <p>{{ .Params.summary }}</p>
          <div class="tech-badges">
            {{ range .Params.tech }}<span class="tech-badge">{{ . }}</span>{{ end }}
          </div>
          <div class="hero-meta">
            {{ with .Params.repo }}<a class="button button-ghost" href="{{ . }}">GitHub</a>{{ end }}
            {{ with .Params.external }}<a class="button button-primary" href="{{ . }}">Demo</a>{{ end }}
          </div>
        </article>
      </div>
    </section>
  {{ end }}

  {{ $allTravel := where .Site.RegularPages "Type" "travel" }}
  {{ $travelLocalized := where $allTravel "Lang" $lang }}
  {{ if and (ne $lang $defaultLang) (lt (len $travelLocalized) 1) }}
    {{ $travelLocalized = where $allTravel "Lang" $defaultLang }}
  {{ end }}
  {{ $travelPoints := first 3 $travelLocalized }}
  <section class="section" aria-labelledby="map-teaser">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title" id="map-teaser">{{ i18n "mapExplore" }}</h2>
        <a href="{{ "/travel/" | relLangURL }}">Travel</a>
      </div>
      <div class="card-grid">
        {{ range $travelPoints }}
          <article class="card">
            <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
            <p>{{ .Summary }}</p>
            <p class="timeline-meta">{{ .Params.city }}, {{ .Params.country }}</p>
          </article>
        {{ end }}
      </div>
    </div>
  </section>
{{ end }}
